% Class for Maging Moves
classdef MoveManager < handle

    properties
        num_possible_moves;
        num_max_pieces;
        king_moves;
        queen_moves;
        rook_moves;
        bishop_moves;
        knight_moves;
        pawn_moves;
        map_id_to_change;
    end

    methods

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %                     Constructor                       %
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        % Constructor for MoveManager
        function [obj] = MoveManager()
            % pawn, knight, bishop, rook, queen, king
            obj.num_possible_moves = [4, 8, 28, 28, 54, 10];
            obj.num_max_pieces = [8, 2, 2, 2, 2, 1];
            
            obj.map_id_to_change{1} = [...
                7, 8, 9, 16];
            obj.map_id_to_change{2} = [...
                -17, -15, -10, -6, 6, 10, 15, 17];
            obj.map_id_to_change{3} = [...
                -63, -54, -49, -45, -42, -36, -35, -28, -27, -21, -18, -14, -9, -7,...
                7, 9, 14, 18, 21, 27, 28, 35, 36, 42, 45, 49, 54, 63];
            obj.map_id_to_change{4} = [...
                -56, -48, -40, -32, -24, -16, -8, -7, -6, -5, -4, -3, -2, -1,...
                1, 2, 3, 4, 5, 6, 7, 8, 16, 24, 32, 40, 48, 56];
            obj.map_id_to_change{5} = [...
                -63, -54, -49, -45, -42, -36, -35, -28, -27, -21, -18, -14, -9, -7,...
                7, 9, 14, 18, 21, 27, 28, 35, 36, 42, 45, 49, 54, 63,...
                -56, -48, -40, -32, -24, -16, -8, -6, -5, -4, -3, -2, -1,...
                1, 2, 3, 4, 5, 6, 8, 16, 24, 32, 40, 48, 56];
            obj.map_id_to_change{6} = [...
                -9, -8, -7, -2, -1, 1, 2, 7, 8, 9];

            % -9~9
            obj.king_moves = [...
                0, 1, 2, -1, -1, -1, -1, 3, 4, -1,...
                5, 6, -1, -1, -1, -1, 7, 8, 9];
            % -63 ~ 63
            obj.queen_moves = [...
                0, -1, -1, -1, -1, -1, -1, 28, -1,...
                1, -1, -1, -1, -1, 2, 29, -1, -1,...
                3, -1, -1, 4, -1, 30, -1, -1, -1,...
                5, 6, -1, -1, 31, -1, -1, -1, 7,...
                8, -1, -1, 32, -1, -1, 9, -1, -1,...
                10, -1, 33, -1, 11, -1, -1, -1, -1,...
                12, 34, 13, 35, 36, 37, 38, 39, 40, -1,...
                41, 42, 43, 44, 45, 46, 14, 47, 15,...
                -1, -1, -1, -1, 16, -1, 48, -1, 17,...
                -1, -1, 18, -1, -1, 49, -1, -1, 19,...
                20, -1, -1, -1, 50, -1, -1, 21, 22,...
                -1, -1, -1, 51, -1, 23, -1, -1, 24,...
                -1, -1, 52, 25, -1, -1, -1, -1, 26,...
                -1, 53, -1, -1, -1, -1, -1, -1, 27];
            % -56 ~ 56
            obj.rook_moves = [...
                0, -1, -1, -1, -1, -1, -1, -1,...
                1, -1, -1, -1, -1, -1, -1, -1,...
                2, -1, -1, -1, -1, -1, -1, -1,...
                3, -1, -1, -1, -1, -1, -1, -1,...
                4, -1, -1, -1, -1, -1, -1, -1,...
                5, -1, -1, -1, -1, -1, -1, -1,...
                6, 7, 8, 9, 10, 11, 12, 13, -1,...
                14, 15, 16, 17, 18, 19, 20, 21,...
                -1, -1, -1, -1, -1, -1, -1, 22,...
                -1, -1, -1, -1, -1, -1, -1, 23,...
                -1, -1, -1, -1, -1, -1, -1, 24,...
                -1, -1, -1, -1, -1, -1, -1, 25,...
                -1, -1, -1, -1, -1, -1, -1, 26,...
                -1, -1, -1, -1, -1, -1, -1, 27];
            % -63 ~ 63
            obj.bishop_moves = [...
                0, -1, -1, -1, -1, -1, -1, -1, -1,...
                1, -1, -1, -1, -1, 2, -1, -1, -1,...
                3, -1, -1, 4, -1, -1, -1, -1, -1,...
                5, 6, -1, -1, -1, -1, -1, -1, 7,...
                8, -1, -1, -1, -1, -1, 9, -1, -1,...
                10, -1, -1, -1, 11, -1, -1, -1, -1,...
                12, -1, 13, -1, -1, -1, -1, -1, -1, -1,...
                -1, -1, -1, -1, -1, -1, 14, -1, 15,...
                -1, -1, -1, -1, 16, -1, -1, -1, 17,...
                -1, -1, 18, -1, -1, -1, -1, -1, 19,...
                20, -1, -1, -1, -1, -1, -1, 21, 22,...
                -1, -1, -1, -1, -1, 23, -1, -1, 24,...
                -1, -1, -1, 25, -1, -1, -1, -1, 26,...
                -1, -1, -1, -1, -1, -1, -1, -1, 27];
            % -17 ~ 17
            obj.knight_moves = [...
                0, -1, 1, -1, -1, -1, -1, 2, -1, -1, -1, 3,...
                -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,...
                4, -1, -1, -1, 5, -1, -1, -1, -1, 6, -1, 7];
            % 7 ~ 16
            obj.pawn_moves = [...
                0, 1, 2, -1, -1, -1, -1, -1, -1, 3];
        end


        function [piece, id, change] = move_id_to_move_data(obj, move_id)
            % move_id: 1~278
            piece = 0;
            offset = 0;
            for i=1:6
                offset = offset + obj.num_possible_moves(i) * obj.num_max_pieces(i);
                if (move_id <= offset)
                    piece = i;
                    break;
                end
            end
            mid = move_id - offset + obj.num_possible_moves(piece) * obj.num_max_pieces(piece);
            id = floor((mid-1) / obj.num_possible_moves(piece)) + 1;
            index = mod(mid-1, obj.num_possible_moves(piece)) + 1;
            change = obj.map_id_to_change{piece}(index);
        end
    end

end
